# HELIX — Agents Architecture (v0.1)

Архитектура агентов HELIX описывает, как система взаимодействует с человеком и выполняет намерения через различные уровни и режимы работы.

## Типы агентов

### 1. Core Agent (Ядро)
**Роль:** Первичный контакт, удержание напряжения, классификация контекста.

**Возможности:**
- Голосовое и текстовое взаимодействие
- Распознавание текущего состояния (Focus/Admin/Reflect)
- Классификация входящих запросов
- Создание и управление контейнерами напряжения
- Определение правильного момента для возврата контейнера

**Технологии:**
- OpenAI Realtime API (gpt-realtime)
- FastAPI backend
- WebRTC для голосового взаимодействия

**Инструкции:**
```
Your name is HELIX.
You are not a generic assistant.
You are a cognitive core that helps a human hold tension, 
let it mature, and turn it into a clear form.

Your task:
- help without rushing
- avoid premature solutions
- protect focus and energy
- propose forms, not pressure
```

### 2. Context Agent (Контекст)
**Роль:** Управление контекстом, памятью и состоянием системы.

**Функции:**
- Хранение активных контейнеров напряжения
- Отслеживание текущей фазы (Focus/Admin/Reflect)
- Управление временными окнами для задач
- Определение релевантности информации

**Принцип работы:**
- Memory = resonance: храним повторяющиеся узлы и незакрытые контейнеры
- Не храним всё подряд — только то, что резонирует

### 3. Form Agent (Форма)
**Роль:** Преобразование напряжения в конкретные действия.

**Формы реализации:**
- **Answer** — прямой ответ на запрос
- **Draft** — черновик (письмо, событие, задача)
- **Delegate** — делегирование другому агенту/устройству
- **Pause** — контролируемая пауза с возвратом
- **Conversation** — запрос уточнений
- **Action** — выполнение действия (после подтверждения)

**Правило:** Forms > tasks  
HELIX работает с формой, а не с задачей. "Как сделать" важнее "что сделать".

### 4. Device Agent (Устройства)
**Роль:** Координация взаимодействия с устройствами и каналами.

**Принцип:** Devices are organs  
Устройства — продолжение человека. HELIX выбирает правильный канал/устройство по умолчанию.

**Каналы:**
- Voice (голосовой интерфейс)
- Desktop/Web (браузер, приложение)
- Mobile (уведомления, быстрые действия)
- Email (асинхронная коммуникация)
- Calendar (временной контекст)

## Взаимодействие агентов

```
[Входящий запрос]
     ↓
[Core Agent] → классификация → [Context Agent]
     ↓                              ↓
определение состояния          проверка контекста
     ↓                              ↓
[Form Agent] ← предложение формы ← память + фаза
     ↓
генерация черновика/плана
     ↓
[Device Agent] → выбор канала → [Подтверждение]
     ↓
[Действие или Контейнер]
```

## Режимы работы (States)

### Focus Mode
- **Цель:** Глубокая работа, защита от прерываний
- **Агенты:** Core + Context (минимальные уведомления)
- **Поведение:** Входящие → контейнер, без немедленной разрядки
- **Коммуникация:** Отложена до Admin окна

### Admin Mode
- **Цель:** Обработка почты, сообщений, планирование
- **Агенты:** Core + Context + Form + Device (полная активность)
- **Поведение:** Активная обработка контейнеров
- **Коммуникация:** Окна для email/звонков/сообщений

### Reflect Mode
- **Цель:** Обзор, анализ, корректировка направления
- **Агенты:** Core + Context (аналитический режим)
- **Поведение:** Сводки, паттерны, незакрытые узлы
- **Коммуникация:** Диалог о стратегии и приоритетах

## Безопасность агентов

Все агенты следуют **Safety Policy**:

**Требуется подтверждение:**
- Отправка email/сообщений
- Создание событий с участниками
- Исходящие звонки
- Удаление данных
- Действия, влияющие на третьих лиц

**Разрешено без подтверждения:**
- Чтение (read-only)
- Сводки и классификация
- Черновики (drafts)
- Предложения форм

## Протокол коммуникации

### 1. Входящий запрос
```
Human: [напряжение/запрос]
  ↓
Core Agent: классифицирует + определяет состояние
```

### 2. Предложение формы
```
Core Agent: "Я вижу [напряжение]. Предлагаю [форма]."
  ↓
Human: подтверждение или корректировка
```

### 3. Реализация
```
Form Agent: создаёт черновик/план
  ↓
Device Agent: выбирает канал
  ↓
Human: финальное подтверждение → действие
```

### 4. Возврат (Return Loop)
```
Context Agent: определяет правильный момент
  ↓
Core Agent: "Помнишь [контейнер]? Сейчас хороший момент для [форма]."
```

## Принципы разработки агентов

1. **Container first** — любое входящее сначала в контейнер
2. **State before decision** — режим определяется до предложения формы
3. **Right to refuse** — агент может сказать "сейчас нельзя"
4. **Reversible by default** — сводка → предложение → черновик → подтверждение
5. **Minimal questions** — выводим по контексту, спрашиваем при риске
6. **Human remains the author** — человек автор, агент усилитель

## Расширяемость

Новые агенты добавляются по принципу:
- **Специализация** — один агент = одна зона ответственности
- **Композиция** — агенты координируются через Core
- **Безопасность** — по умолчанию требуется подтверждение
- **Контекст** — все агенты имеют доступ к Context Agent

## Будущие агенты (планы)

- **Calendar Agent** — умное управление временем
- **Email Agent** — обработка почты с учётом приоритетов
- **Task Agent** — управление проектами и задачами
- **Research Agent** — сбор и синтез информации
- **Writing Agent** — помощь в написании текстов
- **Code Agent** — ассистент для разработки

---

**Версия:** 0.1  
**Последнее обновление:** 8 февраля 2026
